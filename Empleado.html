<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ORLINE — Empleado</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">

  <!-- Estilos -->
  <link rel="stylesheet" href="Estilos/dashboard.css">
  <link rel="shortcut icon" href="Multimedia/icono.ico" type="image/x-icon">

  <!-- Fix rápido (opcional pero recomendado) -->
  <style>
    .panel-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom: 10px;
    }
    .detail-top{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      margin-bottom: 14px;
    }
    .detail-title{ font-weight: 900; font-size: 1.15rem; }
    .detail-meta{ color: var(--muted); font-size: .92rem; margin-top: 4px; }
    .detail-pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid var(--stroke);
      background: color-mix(in srgb, var(--glass2) 90%, transparent);
      color: var(--txt);
      white-space: nowrap;
    }
    .detail-grid{
      display:grid;
      gap:12px;
    }
    .detail-box{
      border: 1px solid var(--stroke);
      background: color-mix(in srgb, var(--glass2) 82%, transparent);
      border-radius: 18px;
      padding: 12px;
    }
    .detail-label{ color: var(--muted); font-size: .9rem; }
    .detail-value{ font-weight: 800; margin-top: 2px; }
    .files-selected{
      margin-top: 12px;
      border-top: 1px solid var(--stroke);
      padding-top: 12px;
    }
    @media (max-width: 992px){
      .detail-top{ flex-direction: column; }
      .detail-pill{ width: fit-content; }
    }
  </style>
</head>

<body class="dash-body">

<!-- =========================
     TOP NAV (DESKTOP)
========================= -->
<header class="topfb d-none d-lg-block">
  <div class="topfb-inner">

    <!-- LEFT -->
    <div class="topfb-left">
      <div class="topfb-brand">
        <div class="topfb-badge">
          <img src="Multimedia/3.png" alt="ORLINE" class="topfb-logoimg">
        </div>
      </div>
    </div>

    <!-- CENTER -->
    <nav class="topfb-center" aria-label="Navegación">
      <a class="topfb-tab active" href="Empleado.html" title="Inicio">
        <i class="bi bi-house-door"></i>
      </a>
    </nav>

    <!-- RIGHT -->
    <div class="topfb-right d-flex align-items-center gap-2">
      <span class="chip" id="navTeamName">
        <i class="bi bi-people me-1"></i> —
      </span>

      <button class="topfb-iconbtn" id="btnTheme" type="button" title="Tema">
        <i class="bi bi-moon-stars"></i>
      </button>

      <button class="topfb-iconbtn" data-bs-toggle="modal" data-bs-target="#logoutModal" title="Cerrar sesión">
        <i class="bi bi-box-arrow-right"></i>
      </button>
    </div>

  </div>
</header>

<!-- =========================
     MAIN
========================= -->
<main class="dashwrap dashwrap--wide">

  <!-- OJO: layout3--fb es GRID 3 columnas -->
  <div class="layout3 layout3--fb">

    <!-- ✅ FULL WIDTH: BIENVENIDA -->
    <section class="glass p-4" style="grid-column: 1 / -1;">
      <div class="d-flex flex-wrap justify-content-between gap-3">

        <div class="d-flex align-items-start gap-3">
          <div class="avatarbig d-flex align-items-center justify-content-center">
            <i class="bi bi-person-badge"></i>
          </div>

          <div>
            <h4 class="fw-black mb-1">
              Bienvenido, <span id="empWelcomeName">—</span>
            </h4>
            <div class="muted">
              Gestiona órdenes y archivos. <b>Solo puedes subir archivos cuando la orden esté en proceso.</b>
            </div>

            <div class="d-flex flex-wrap gap-2 mt-3">
              <button class="btn btn-soft py-1 px-3" id="chipPendingQuick" type="button">
                <i class="bi bi-hourglass-split me-1"></i>Pendientes
              </button>
              <button class="btn btn-soft py-1 px-3" id="chipReadyQuick" type="button">
                <i class="bi bi-check2-circle me-1"></i>Listas
              </button>
              <button class="btn btn-soft py-1 px-3" id="chipDeliveredQuick" type="button">
                <i class="bi bi-box-seam me-1"></i>Entregadas
              </button>
            </div>
          </div>
        </div>

        <!-- KPIs -->
        <div class="d-flex flex-wrap gap-2">
          <div class="cardx px-3 py-2">
            <div class="muted small">Pendientes</div>
            <div class="fw-black fs-5" id="kpiPending">0</div>
          </div>
          <div class="cardx px-3 py-2">
            <div class="muted small">En proceso</div>
            <div class="fw-black fs-5" id="kpiProcess">0</div>
          </div>
          <div class="cardx px-3 py-2">
            <div class="muted small">Listas</div>
            <div class="fw-black fs-5" id="kpiReady">0</div>
          </div>
          <div class="cardx px-3 py-2">
            <div class="muted small">Entregadas</div>
            <div class="fw-black fs-5" id="kpiDelivered">0</div>
          </div>
        </div>

      </div>
    </section>

    <!-- ✅ FULL WIDTH: FILTROS -->
    <section class="glass p-4" style="grid-column: 1 / -1;">
      <div class="row g-3 align-items-end">

        <div class="col-12 col-lg-5">
          <label class="muted small mb-1">Buscar orden</label>
          <input id="oSearch" class="form-control form-glass"
                 placeholder="Folio, paciente, doctor, teléfono...">
        </div>

        <div class="col-6 col-lg-2">
          <label class="muted small mb-1">Estatus</label>
          <select id="oFilterStatus" class="form-select form-glass">
            <option value="all">Todos</option>
            <option value="pending">Pendiente</option>
            <option value="process">En proceso</option>
            <option value="ready">Listo</option>
            <option value="delivered">Entregado</option>
          </select>
        </div>

        <div class="col-6 col-lg-2">
          <label class="muted small mb-1">Ordenar</label>
          <select id="oSort" class="form-select form-glass">
            <option value="recent">Más recientes</option>
            <option value="old">Más antiguas</option>
            <option value="doctor">Doctor A–Z</option>
            <option value="patient">Paciente A–Z</option>
            <option value="status">Estatus</option>
          </select>
        </div>

        <div class="col-12 col-lg-3 d-flex gap-2 justify-content-lg-end">
          <button id="btnRefreshOrders" class="btn btn-soft flex-grow-1 flex-lg-grow-0" type="button">
            <i class="bi bi-arrow-clockwise me-2"></i>Actualizar
          </button>
          <button id="btnExportOrders" class="btn btn-primary flex-grow-1 flex-lg-grow-0" type="button">
            <i class="bi bi-download me-2"></i>Exportar
          </button>
        </div>

      </div>

      <div id="empMsg" class="alert alert-success d-none mt-3 mb-0" role="alert"></div>
      <div id="empErr" class="alert alert-danger d-none mt-3 mb-0" role="alert"></div>
    </section>

    <!-- ✅ AQUÍ YA VAN LAS 3 COLUMNAS REALES -->
    <section style="grid-column: 1 / -1;">
      <div class="row g-3">

        <!-- ÓRDENES -->
        <div class="col-12 col-lg-4">
          <div class="glass p-3 h-100">
            <div class="panel-head">
              <div class="fw-bold"><i class="bi bi-inbox me-2"></i>Órdenes</div>
              <div class="muted small" id="oResultsInfo">0 resultados</div>
            </div>

            <div id="ordersList" class="d-flex flex-column gap-2"></div>

            <div id="ordersEmpty" class="text-center p-4 d-none">
              <i class="bi bi-inbox fs-1" style="opacity:.55"></i>
              <div class="fw-bold mt-2">Sin órdenes</div>
              <div class="muted">Cuando un doctor cree una orden, aparecerá aquí.</div>
            </div>
          </div>
        </div>

        <!-- DETALLE -->
        <div class="col-12 col-lg-5">
          <div class="glass p-4 h-100" id="orderDetail">

            <div id="orderDetailEmpty">
              <div class="fw-bold mb-1">Selecciona una orden</div>
              <div class="muted">Aquí verás el detalle completo.</div>
            </div>

            <div id="orderDetailBody" class="d-none">

              <div class="detail-top">
                <div>
                  <div class="detail-title" id="odFolio">—</div>
                  <div class="detail-meta" id="odMeta">—</div>
                </div>

                <div class="detail-pill">
                  <i class="bi bi-activity"></i>
                  <span id="odStatusText">—</span>
                </div>
              </div>

              <!-- IMPORTANTE: tu JS usa #odStatus para guardar status -->
              <div class="mb-3">
                <label class="muted small mb-1">Estatus</label>
                <select id="odStatus" class="form-select form-glass">
                  <option value="pending">Pendiente</option>
                  <option value="process">En proceso</option>
                  <option value="ready">Listo</option>
                  <option value="delivered">Entregado</option>
                </select>

                <!-- ✅ ID único (antes estaba duplicado) -->
                <div class="muted tiny mt-1">Actual: <span id="odStatusText2">—</span></div>
              </div>

              <div class="detail-grid">

                <div class="detail-box">
                  <div class="detail-label">Paciente</div>
                  <div class="detail-value" id="odPatientName">—</div>
                  <div class="muted small" id="odPatientPhone">—</div>
                </div>

                <div class="detail-box">
                  <div class="detail-label">Doctor</div>
                  <div class="detail-value" id="odDoctorName">—</div>
                  <div class="muted small" id="odDoctorClinic">—</div>
                </div>

                <div class="detail-box">
                  <div class="detail-label">Estudio</div>
                  <div class="detail-value" id="odStudy">—</div>
                </div>

                <div class="detail-box">
                  <div class="detail-label">Notas del doctor</div>
                  <div class="muted" id="odNotesDoctor">—</div>
                </div>

                <div class="detail-box">
                  <div class="detail-label">Notas internas (equipo)</div>
                  <textarea id="odInternalNotes" class="form-control form-glass" rows="3" placeholder="Notas internas..."></textarea>

                  <div class="text-end mt-3">
                    <button id="btnSaveOrderChanges" class="btn btn-primary" type="button">
                      <i class="bi bi-check2-circle me-2"></i>Guardar
                    </button>
                  </div>
                </div>

              </div>
            </div>

          </div>
        </div>

        <!-- ARCHIVOS -->
        <div class="col-12 col-lg-3">
          <div class="glass p-3 h-100">

            <div class="panel-head">
              <div class="fw-bold"><i class="bi bi-folder2-open me-2"></i>Archivos</div>
            </div>

            <div id="dropzone" class="cardx p-4 text-center mb-3" style="border:1px dashed var(--stroke); cursor:pointer;">
              <i class="bi bi-cloud-arrow-up fs-4"></i>
              <div class="fw-bold mt-2">Arrastra aquí</div>
              <div class="muted small">o da click para seleccionar</div>

              <!-- ✅ accept recomendado para que el picker no te deje elegir cosas raras -->
              <input id="filePicker" type="file" class="d-none" multiple accept="image/*,.txt" />

              <div id="uploadMsg" class="muted small mt-2"></div>
            </div>

            <div id="orderFilesList" class="d-flex flex-column gap-2"></div>

            <div id="orderFilesEmpty" class="text-center p-4">
              <i class="bi bi-paperclip fs-1" style="opacity:.55"></i>
              <div class="fw-bold mt-2">Sin archivos</div>
              <div class="muted">Selecciona una orden en proceso.</div>
            </div>

            <div class="files-selected">
              <div class="muted small">Orden seleccionada</div>
              <div class="fw-bold" id="odSelectedMini">—</div>
            </div>

          </div>
        </div>

      </div>
    </section>

  </div>
</main>

<!-- =========================
     MODAL LOGOUT
========================= -->
<div class="modal fade" id="logoutModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content modal-dark">
      <div class="modal-header border-0">
        <h5 class="modal-title">Cerrar sesión</h5>
        <button class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body">
        <p class="muted mb-0">¿Seguro que deseas cerrar sesión?</p>
      </div>
      <div class="modal-footer border-0">
        <button class="btn btn-soft" data-bs-dismiss="modal" type="button">Cancelar</button>
        <button id="confirmLogout" class="btn btn-danger" type="button">Cerrar sesión</button>
      </div>
    </div>
  </div>
</div>

<!-- =========================
     SCRIPTS
========================= -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
<script type="module" src="JavaScript/Empleado.js"></script>
<script src="JavaScript/theme.js"></script>
<script src="JavaScript/topnav.js"></script>

</body>
</html>
